<?xml version="1.0" encoding="utf-8"?>

<odoo>
    <!-- Window actions -->
    <record id="webscrape_site_action_window" model="ir.actions.act_window">
	<field name="name">Webscrape Site</field>
	<field name="res_model">webscrape.site</field>
    </record>

    <record id="webscrape_type_action_window" model="ir.actions.act_window">
	<field name="name">Webscrape Type Mapping</field>
	<field name="res_model">webscrape.type.mapping.line</field>
	<field name="context">{'default_res_id': active_id}</field>
    </record>

    <record id="webscrape_page_action_window" model="ir.actions.act_window">
	<field name="name">Webscrape Page</field>
	<field name="res_model">webscrape.page</field>
    </record>

    <record id="webscrape_object_action_window" model="ir.actions.act_window">
	<field name="name">Webscrape Object</field>
	<field name="res_model">webscrape.object</field>
    </record>

    <record id="webscrape_rule_action_window" model="ir.actions.act_window">
	<field name="name">Webscrape Rule</field>
	<field name="res_model">webscrape.rule</field>
    </record>

    <!-- Views -->
    <record id="webscrape_site_list_view" model="ir.ui.view">
	<field name="name">Webscrape sites</field>
	<field name="model">webscrape.site</field>
	<field name="arch" type="xml">
	    <tree>
		<field name="name"/>
		<field name="batch_size"/>
		<field name="last_fetch"/>
	    </tree>
	</field>
    </record>

    <record id="webscrape_site_form_view" model="ir.ui.view">
	<field name="name">Webscrape Site</field>
	<field name="model">webscrape.site</field>
	<field name="arch" type="xml">
	    <form>
		<sheet>
		    <group>
			<field name="name"/>
			<field name="scraper_id"/>
		    </group>
		    <group>
			<field name="batch_size"/>
			<field name="last_fetch"/>
		    </group>
		    <separator string="Content types"/>
		    <field name="type_mapping_line_ids">
			<tree editable="bottom">
			    <field name="sequence" widget="handle"/>
			    <field name="name"/>
			    <button string="open" type="object"
				    name="button_details"
				    />
			    <field name="content_type"/>
			    <field name="model_id"/>
			    <field name="source_id_key"/>
			</tree>
		    </field>
		</sheet>
	    </form>
	</field>
    </record>

    <record id="webscrape_type_mapping_line_form_view" model="ir.ui.view">
	<field name="name">Webscrape Type Mapping</field>
	<field name="model">webscrape.type.mapping.line</field>
	<field name="arch" type="xml">
	    <form>
		<sheet>
		    <group>
			<field name="name"/>
			<field name="content_type"/>
			<field name="source_id_key"/>
			<field name="model_id"/>
		    </group>
		    <separator string="Field mapping"/>
		    <field name="field_mapping_line_ids">
			<tree editable="bottom">
			    <field name="source_key"/>
			    <field name="target_model" invisible="1"/>
			    <field name="target_field"
				   domain="[('model', '=', target_model)]"
				   />
			</tree>
		    </field>
		    <separator string="Pre write rules"/>
		    <field name="rule_ids_pre">
			<tree>
			    <field name="sequence" widget="handle"/>
			    <field name="name"/>
			    <field name="key"/>
			    <field name="operation" widget="selection"/>
			    <field name="condition"/>
			</tree>
		    </field>
		    <separator string="Post write rules"/>
		    <field name="rule_ids_post">
			<tree>
			    <field name="sequence" widget="handle"/>
			    <field name="name"/>
			    <field name="key"/>
			    <field name="operation" widget="selection"/>
			    <field name="condition"/>
			</tree>
		    </field>
		</sheet>
	    </form>
	</field>
    </record>

    <record id="webscrape_page_list_view" model="ir.ui.view">
	<field name="name">Webscrape pages</field>
	<field name="model">webscrape.page</field>
	<field name="arch" type="xml">
	    <tree decoration-danger="notes">
		<field name="url"/>
		<field name="last_mod"/>
		<field name="last_scrape"/>
		<field name="skip"/>
		<field name="notes" invisible="1"/>
	    </tree>
	</field>
    </record>

    <record id="webscrape_page_form_view" model="ir.ui.view">
	<field name="name">Webscrape page details</field>
	<field name="model">webscrape.page</field>
	<field name="arch" type="xml">
	    <form>
		<sheet>
		    <group>
			<field name="url"/>
			<field name="site_id"/>
			<field name="priority"/>
			<field name="skip"/>
		    </group>
		    <group>
			<field name="changefreq"/>
			<field name="last_mod"/>
			<field name="last_scrape"/>
		    </group>
		    <separator string="Notes"/>
		    <field name="notes"/>
		    <separator string="Related objects"/>
		    <field name="object_ids">
			<tree>
			    <field name="model_id"/>
			    <field name="related_record"/>
			    <field name="source_id"/>
			    <field name="priority"/>
			</tree>
		    </field>
		</sheet>
	    </form>
	</field>
    </record>

    <record id="webscrape_object_list_view" model="ir.ui.view">
	<field name="name">Webscrape Objects</field>
	<field name="model">webscrape.object</field>
	<field name="arch" type="xml">
	    <tree>
		<field name="name"/>
		<field name="source_id"/>
		<field name="model_model"/>
	    </tree>
	</field>
    </record>

    <record id="webscrape_object_form_view" model="ir.ui.view">
	<field name="name">Webscrape Objects</field>
	<field name="model">webscrape.object</field>
	<field name="arch" type="xml">
	    <form>
		<group>
		    <field name="name"/>
		    <field name="source_id"/>
		    <field name="model_id"/>
		    <field name="related_record"/>
		</group>
		<notebook>
		    <page string="Type mappings">
			<field name="type_mapping_line_ids">
			    <tree>
				<field name="name"/>
				<field name="content_type"/>
				<field name="source_id_key"/>
				<field name="model_id"/>
			    </tree>
			</field>
		    </page>
		    <page string="Pages">
			<field name="page_ids">
			    <tree>
				<field name="url"/>
			    </tree>
			</field>
		    </page>
		    <page string="Pre write rules">
			<field name="rule_ids_pre">
			    <tree>
				<field name="sequence" widget="handle"/>
				<field name="name"/>
				<field name="key"/>
				<field name="operation" widget="selection"/>
				<field name="condition"/>
			    </tree>
			</field>
		    </page>
		    <page string="Post write rules">
			<field name="rule_ids_post">
			    <tree>
				<field name="sequence" widget="handle"/>
				<field name="name"/>
				<field name="key"/>
				<field name="operation" widget="selection"/>
				<field name="condition"/>
			    </tree>
			</field>
		    </page>
		</notebook>
	    </form>
	</field>
    </record>

    <record id="webscrape_rule_form_view" model="ir.ui.view">
	<field name="name">Webscrape Process Rule</field>
	<field name="model">webscrape.rule</field>
	<field name="arch" type="xml">
	    <form>
		<sheet>
		    <group>
			<field name="name"/>
			<field name="pre_post"/>
			<field name="key"/>
		    </group>
		    <group>
			<field name="type_mapping_line_id"/>
			<field name="object_id"/>
		    </group>
		    <separator string="Operations"/>
		    <group>
			<field name="operation" widget="selection"/>
			<field name="operation_help" widget="selection"/>
			<field name="condition" style="font-family: monospace;" class="bg-dark text-light"/>
		    </group>
		    <group attrs="{'invisible': [('operation', '!=', 'replace')]}">
			<field name="sub_pattern" style="font-family: monospace;" class="bg-dark text-light"/>
			<field name="sub_repl" style="font-family: monospace;" class="bg-dark text-light"/>
			<field name="sub_count"/>
		    </group>
		    <group attrs="{'invisible': [('operation', '!=', 'lambda')]}">
			<field name="lambda_str"
			       style="font-family: monospace;" class="bg-dark text-light"/>
		    </group>
		    <group attrs="{'invisible': [('operation', '!=', 'orm_ref')]}">
			<field name="orm_ref"
			       style="font-family: monospace;" class="bg-dark text-light"/>
		    </group>
		    <group attrs="{'invisible': [('operation', '!=', 'orm_expr')]}">
			<field name="orm_model"/>
			<field name="orm_domain" style="font-family: monospace;" class="bg-dark text-light"/>
			<field name="orm_limit"/>
			<field name="orm_filter" style="font-family: monospace;" class="bg-dark text-light"/>
			<field name="orm_map" style="font-family: monospace;" class="bg-dark text-light"/>
			<field name="orm_field" style="font-family: monospace;" class="bg-dark text-light"/>
		    </group>
		</sheet>
	    </form>
	</field>
    </record>

    <!-- Manus -->
    <menuitem id="webscrape_menu_parent"
	      name="Webscrape"
	      parent="base.menu_administration"/>
	      
    <menuitem id="webscrape_menu_sites"
	      name="Sites"
	      parent="webscrape_menu_parent"
	      action="webscrape_site_action_window"/>
	      
    <menuitem id="webscrape_menu_pages"
	      name="Pages"
	      parent="webscrape_menu_parent"
	      action="webscrape_page_action_window"/>

    <menuitem id="webscrape_menu_objects"
	      name="Objects"
	      parent="webscrape_menu_parent"
	      action="webscrape_object_action_window"/>

</odoo>

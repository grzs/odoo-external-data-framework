<?xml version="1.0" encoding="utf-8"?>

<odoo>
    <!-- Site -->
    <record model="webscrape.scraper.meleget.hu" id="scraper_meleget_hu">
        <field name="name">meleget.hu</field>
        <field name="base_url">https://www.meleget.hu</field>
    </record>

    <!-- Content Type Mapping -->
    <record model="webscrape.type.mapping.line" id="meleget_hu_category">
        <field name="site_id"
               search="[('name', '=', 'meleget.hu')]"/>
        <field name="name">category &gt; public.category</field>
	<field name="sequence">1</field>
	<field name="content_type">category</field>
        <field name="model_id" ref="website_sale.model_product_public_category"/>
        <field name="source_id_key">href</field>
    </record>

    <record model="webscrape.type.mapping.line" id="meleget_hu_product">
        <field name="site_id"
               search="[('name', '=', 'meleget.hu')]"/>
        <field name="name">product &gt; product.template</field>
	<field name="sequence">2</field>
	<field name="content_type">product</field>
        <field name="model_id" ref="product.model_product_template"/>
        <field name="source_id_key">sku</field>
    </record>

    <record model="webscrape.type.mapping.line" id="meleget_hu_product_pricelist_item">
        <field name="site_id"
               search="[('name', '=', 'meleget.hu')]"/>
        <field name="name">product &gt; product.pricelist.item</field>
	<field name="sequence">3</field>
	<field name="content_type">product</field>
        <field name="model_id" ref="product.model_product_pricelist_item"/>
        <field name="source_id_key">sku</field>
    </record>

    <!-- Field Mapping product -->
    <record model="webscrape.field.mapping.line" id="meleget_hu_product_field_sku">
        <field name="type_mapping_line_id" ref="custom_webscrape_module.meleget_hu_product"/>
        <field name="source_key">sku</field>
        <field name="target_field" ref="product.field_product_template__default_code"/>
    </record>

    <record model="webscrape.field.mapping.line" id="meleget_hu_product_field_name">
        <field name="type_mapping_line_id" ref="custom_webscrape_module.meleget_hu_product"/>
        <field name="source_key">name</field>
        <field name="target_field" ref="product.field_product_template__name"/>
    </record>

    <!-- Field Mapping category -->
    <record model="webscrape.field.mapping.line" id="meleget_hu_category_field_name">
        <field name="type_mapping_line_id" ref="custom_webscrape_module.meleget_hu_category"/>
        <field name="source_key">name</field>
        <field name="target_field" ref="website_sale.field_product_public_category__name"/>
    </record>

    <!-- Field MApping & Rules pricelist -->
    <record model="webscrape.field.mapping.line" id="meleget_hu_pricelist_item_field_fixed_price">
        <field name="type_mapping_line_id" ref="custom_webscrape_module.meleget_hu_product_pricelist_item"/>
        <field name="source_key">price</field>
        <field name="target_field" ref="product.field_product_pricelist_item__fixed_price"/>
    </record>

    <record model="webscrape.rule" id="meleget_hu_pricelist_item_rule_pricelist_id">
        <field name="type_mapping_line_id" ref="custom_webscrape_module.meleget_hu_product_pricelist_item"/>
	<field name="pre_post">pre</field>
	<field name="name">pricelist_id</field>
	<field name="key">pricelist_id</field>
	<field name="sequence">1</field>
	<field name="operation">orm_ref</field>
	<field name="orm_ref">custom_webscrape_module.meleget_hu_pricelist_list</field>
    </record>

    <record model="webscrape.rule" id="meleget_hu_pricelist_item_rule_compute_price">
        <field name="type_mapping_line_id" ref="custom_webscrape_module.meleget_hu_product_pricelist_item"/>
	<field name="pre_post">pre</field>
	<field name="name">compute_price</field>
	<field name="key">compute_price</field>
	<field name="sequence">2</field>
	<field name="operation">lambda</field>
	<field name="lambda_str">'fixed'</field>
    </record>

    <record model="webscrape.rule" id="meleget_hu_pricelist_item_rule_applied_on">
        <field name="type_mapping_line_id" ref="custom_webscrape_module.meleget_hu_product_pricelist_item"/>
	<field name="pre_post">pre</field>
	<field name="name">applied_on</field>
	<field name="key">applied_on</field>
	<field name="sequence">3</field>
	<field name="operation">lambda</field>
	<field name="lambda_str">'1_product'</field>
    </record>

    <record model="webscrape.rule" id="meleget_hu_pricelist_item_rule_product_tmpl_id">
        <field name="type_mapping_line_id" ref="custom_webscrape_module.meleget_hu_product_pricelist_item"/>
	<field name="pre_post">pre</field>
	<field name="name">product_tmpl_id</field>
	<field name="key">product_tmpl_id</field>
	<field name="sequence">4</field>
	<field name="operation">orm_expr</field>
	<field name="orm_model" ref="custom_webscrape_module.model_webscrape_object"/>
	<field name="orm_domain">[('model_model', '=', 'product.template'), ('source_id', '=', '{sku}')]</field>
	<field name="orm_field">related_record</field>
    </record>

    <record model="webscrape.rule" id="meleget_hu_pricelist_item_rule_date_start">
        <field name="type_mapping_line_id" ref="custom_webscrape_module.meleget_hu_product_pricelist_item"/>
	<field name="pre_post">pre</field>
	<field name="name">date_start</field>
	<field name="key">date_start</field>
	<field name="sequence">5</field>
	<field name="operation">lambda</field>
	<field name="lambda_str">datetime.now()</field>
    </record>

    <!-- Vendor -->
    <record model="res.partner" id="meleget_hu_vendor">
	<field name="name">Hideget-meleget Kft.</field>
	<field name="company_type">company</field>
    </record>

    <!-- Pricelist -->
    <record model="product.pricelist" id="meleget_hu_pricelist_list">
	<field name="name">Meleget.hu list price</field>
    </record>

    <record model="product.pricelist" id="meleget_hu_pricelist_sale">
	<field name="name">Meleget.hu sale price</field>
    </record>

    <!-- Cron -->
    <record model="ir.cron" id="webscrape_cron_malaget_hu_process_sitemap">
        <field name="name">meleget.hu process sitemap</field>
        <field name="model_id" ref="model_webscrape_site"/>
        <field name="active" eval="False"/>
        <field name="interval_type">days</field>
        <field name="interval_number" eval="1"/>
        <field name="numbercall" eval="-1"/>
        <field name="code"><![CDATA[
site = model.search([('base_url', 'like', 'meleget.hu')], limit=1)
site.process_sitemap()
]]></field>
    </record>

    <record model="ir.cron" id="webscrape_cron_malaget_hu_scrape_all">
        <field name="name">meleget.hu batch scrape all</field>
        <field name="model_id" ref="model_webscrape_site"/>
        <field name="active" eval="False"/>
        <field name="interval_type">days</field>
        <field name="interval_number" eval="1"/>
        <field name="numbercall" eval="-1"/>
        <field name="code"><![CDATA[
site = model.search([('base_url', 'like', 'meleget.hu')], limit=1)
site.batch_scrape(sync=True, prune=False)
]]></field>
    </record>

    <record model="ir.cron" id="webscrape_cron_malaget_hu_scrape_categories">
        <field name="name">meleget.hu batch scrape categories</field>
        <field name="model_id" ref="model_webscrape_site"/>
        <field name="active" eval="False"/>
        <field name="interval_type">days</field>
        <field name="interval_number" eval="1"/>
        <field name="numbercall" eval="-1"/>
        <field name="code"><![CDATA[
content_type = 'category'
site = model.search([('base_url', 'like', 'meleget.hu')], limit=1)
type_mapping_line_id = model.type_mapping_line_ids.search(
    [('name', '=', content_type), ('site_id', '=', site.id)],
    limit=1,
)
site.batch_scrape(
    type_mapping_line_id=type_mapping_line_id.id,
    sync=True, prune=False,
)
]]></field>
    </record>

    <record model="ir.cron" id="webscrape_cron_malaget_hu_scrape_products">
        <field name="name">meleget.hu batch scrape products</field>
        <field name="model_id" ref="model_webscrape_site"/>
        <field name="active" eval="False"/>
        <field name="interval_type">days</field>
        <field name="interval_number" eval="1"/>
        <field name="numbercall" eval="-1"/>
        <field name="code"><![CDATA[
content_type = 'product'
site = model.search([('base_url', 'like', 'meleget.hu')], limit=1)
type_mapping_line_id = model.type_mapping_line_ids.search(
    [('name', '=', content_type), ('site_id', '=', site.id)],
    limit=1,
)
site.batch_scrape(
    type_mapping_line_id=type_mapping_line_id.id,
    sync=True, prune=False,
)
]]></field>
    </record>

</odoo>

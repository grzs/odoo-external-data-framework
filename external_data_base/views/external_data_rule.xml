<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- Window actions -->
    <record id="external_data_rule_action_window" model="ir.actions.act_window">
	<field name="name">External Data Rule</field>
	<field name="res_model">external.data.rule</field>
    </record>

    <!-- Views -->
    <record id="external_data_rule_form_view" model="ir.ui.view">
	<field name="name">External Data Process Rule</field>
	<field name="model">external.data.rule</field>
	<field name="arch" type="xml">
	    <form>
		<sheet>
		    <group>
			<field name="name"/>
			<field name="pre_post"/>
			<field name="key"/>
		    </group>
		    <group>
			<field name="field_mapping_id"/>
			<field name="object_id"/>
		    </group>
		    <group>
			<field name="operation" widget="selection"/>
			<field name="operation_help" widget="selection"/>
		    </group>
		    <notebook>
			<page string="Parameters">
			    <group attrs="{'invisible': [('operation', '!=', 'drop')]}">
				<field name="drop_delete"/>
			    </group>
			    <group attrs="{'invisible': [('operation', '!=', 'replace')]}">
				<field name="sub_pattern" style="font-family: monospace;" class="bg-dark text-light"/>
				<field name="sub_repl" style="font-family: monospace;" class="bg-dark text-light"/>
				<field name="sub_count"/>
			    </group>
			    <group attrs="{'invisible': [('operation', '!=', 'hashtable')]}">
				<field name="hashtable" style="font-family: monospace;" class="bg-dark text-light"/>
			    </group>
			    <group attrs="{'invisible': [('operation', '!=', 'parse_time')]}">
				<field name="parse_time_pattern" style="font-family: monospace;" class="bg-dark text-light"/>
			    </group>
			    <group attrs="{'invisible': [('operation', '!=', 'lambda')]}">
				<field name="lambda_str"
				       style="font-family: monospace;" class="bg-dark text-light"/>
			    </group>
			    <group attrs="{'invisible': [('operation', '!=', 'eval')]}">
				<field name="eval_str"
				       style="font-family: monospace;" class="bg-dark text-light"/>
			    </group>
			    <group attrs="{'invisible': [('operation', '!=', 'orm_ref')]}">
				<field name="orm_ref"
				       style="font-family: monospace;" class="bg-dark text-light"/>
			    </group>
			    <group attrs="{'invisible': [('operation', '!=', 'orm_expr')]}">
				<field name="orm_model"/>
				<field name="orm_domain" style="font-family: monospace;" class="bg-dark text-light"/>
				<field name="orm_limit"/>
				<field name="orm_filter" style="font-family: monospace;" class="bg-dark text-light"/>
				<field name="orm_map" style="font-family: monospace;" class="bg-dark text-light"/>
				<field name="orm_field" style="font-family: monospace;" class="bg-dark text-light"/>
			    </group>
			    <group attrs="{'invisible': [('operation', '!=', 'object_link')]}">
				<field name="obj_source_id"/>
				<field name="obj_mapping_id" domain="[('data_source_id', '=', obj_source_id)]"/>
				<field name="obj_foreign_type_id"/>
				<field name="obj_model_id"/>
			    </group>
			</page>
			<page string="Conditions">
			    <group>
				<field name="condition_operator"/>
			    </group>
			    <field name="condition" nolabel="1" style="font-family: monospace;" class="bg-dark text-light"/>
			</page>
		    </notebook>
		</sheet>
	    </form>
	</field>
    </record>

    <record model="external.data.rule" id="list_rule_data_source_id">
	<field name="pre_post">pre</field>
	<field name="name">data_source_id from metadata</field>
	<field name="key">data_source_id</field>
	<field name="sequence">1</field>
	<field name="operation">eval</field>
	<field name="eval_str">metadata.get('data_source_id')</field>
    </record>

</odoo>
